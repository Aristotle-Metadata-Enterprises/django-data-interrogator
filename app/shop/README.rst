This code is derived from a Shop module developed by @jarshwah. See the full code below:
https://github.com/jarshwah/customsql_talk